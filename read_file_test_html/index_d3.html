<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
            <title>
                Load Json
            </title>
            <script src="https://d3js.org/d3.v7.min.js">
            </script>
        </meta>
    </head>
    <body>
        <h1>HI</h1>
        <p id="h"></p>

        <div class="pie">
        <h2>Pie Quality Item </h2>
        <label for="platform"  style="white">Platform Selection</label>
        <select id="platform"  class="platform">
            <option value="">------</option>
            <option value="cma">CMA</option>
            <option value="spa">SPA</option>
        </select>
        <label for="software">Software Version</label>
        <select id="software" class="software">
            <option value="">------</option>
            <option value="1">01</option>
            <option value="2">02</option>
            <option value="3">03</option>
        </select>

         <label for="time">Time range/week</label>
        <input type="week" value="2023-W10" name="week" id="time" class="pie_time"></input>
            
        </select>
        <button id="search">Search</button>
        </div>


    </body>
    <script>
        
        const pie_button= document.querySelector(".pie #search");


        pie_button.addEventListener("click",mypie);

        function mypie() {

        var pie_platform = document.querySelector(".pie #platform");
        var pie_software = document.querySelector(".pie #software");
        var pie_time = document.querySelector(".pie #time");
        const error_items = Object();
        pie_data("data_test.csv", pie_platform.value, pie_software.value, pie_time.value);

        document.getElementById("h").innerHTML =  error_items;
        };



        function pie_data(file, platform, sofware, time){
            d3.csv(file)
                .then(function(csvdata){
                    return csvdata.filter(function(d){
                        return d.platform==platform;
                                    })
                    })
                .then(function(csvplatform){
                        return csvplatform.filter(function(d){
                            return d.software_version == software;
                            })

                    })
                .then(function(csv_ps){
                        return csv_ps.filter(function(d){
                            return d.time_week== time;
                            })

                    })
                .then(function(csv_filtered){
                     error_items = csv_filtered;
                       
                    })
            };

     
    

     
    </script>
</html>
